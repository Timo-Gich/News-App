<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Currents News - Global News Aggregator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“°</text></svg>">
    <!-- Add these lines to your existing <head> -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Currents News">
    <link rel="apple-touch-icon" href="https://img.icons8.com/color/192/000000/news.png">
    <meta name="description" content="Global news aggregator with offline reading capability">
</head>

<body>
    <!-- Header & Navigation -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-newspaper"></i>
                <h1>Currents<span>News</span></h1>
            </div>

            <nav class="nav">
                <div class="nav-toggle">
                    <i class="fas fa-bars"></i>
                </div>
                <ul class="nav-menu">
                    <li><a href="#" class="nav-link active" data-category="latest"><i class="fas fa-home"></i> Latest</a></li>
                    <li><a href="#" class="nav-link" data-category="world"><i class="fas fa-globe"></i> World</a></li>
                    <li><a href="#" class="nav-link" data-category="politics"><i class="fas fa-landmark"></i> Politics</a></li>
                    <li><a href="#" class="nav-link" data-category="business"><i class="fas fa-chart-line"></i> Business</a></li>
                    <li><a href="#" class="nav-link" data-category="technology"><i class="fas fa-laptop-code"></i> Tech</a></li>
                    <li><a href="#" class="nav-link" data-category="sports"><i class="fas fa-running"></i> Sports</a></li>
                    <li><a href="#" class="nav-link" data-category="entertainment"><i class="fas fa-film"></i> Entertainment</a></li>
                    <!-- NEW: Offline Articles Nav Item -->
                    <li>
                        <a href="#" class="nav-link" data-category="offline" id="offline-nav-link" style="display: none;">
                            <i class="fas fa-download"></i> Offline
                            <span class="offline-count-badge" id="offline-count">0</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div class="header-controls">
                <!-- NEW: Offline Stats Indicator -->
                <div class="offline-stats" id="offline-stats" style="display: none;">
                    <i class="fas fa-download"></i>
                    <span id="offline-article-count">0</span>
                </div>

                <button class="theme-toggle" title="Toggle dark mode">
                    <i class="fas fa-moon"></i>
                </button>
                <div class="language-selector">
                    <select id="language-select">
                        <option value="en">English</option>
                        <option value="es">Spanish</option>
                        <option value="fr">French</option>
                        <option value="de">German</option>
                        <option value="it">Italian</option>
                        <option value="pt">Portuguese</option>
                    </select>
                </div>
            </div>
        </div>
    </header>

    <!-- Search & Filter Section -->
    <section class="search-section">
        <div class="container">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="Search for news, topics, or keywords...">
                <button id="search-btn" class="btn btn-primary">
                    <i class="fas fa-search"></i> Search
                </button>
                <button id="advanced-toggle" class="btn btn-secondary">
                    <i class="fas fa-filter"></i> Filters
                </button>
                <!-- NEW: Offline Actions Button -->
                <button id="offline-actions-btn" class="btn btn-secondary" style="display: none;">
                    <i class="fas fa-download"></i> Offline
                </button>
            </div>

            <div class="advanced-filters" id="advanced-filters">
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="start-date"><i class="far fa-calendar-alt"></i> Start Date</label>
                        <input type="date" id="start-date">
                    </div>
                    <div class="filter-group">
                        <label for="end-date"><i class="far fa-calendar-alt"></i> End Date</label>
                        <input type="date" id="end-date">
                    </div>
                    <div class="filter-group">
                        <label for="category-filter"><i class="fas fa-tag"></i> Category</label>
                        <select id="category-filter">
                            <option value="">All Categories</option>
                            <option value="world">World</option>
                            <option value="politics">Politics</option>
                            <option value="business">Business</option>
                            <option value="technology">Technology</option>
                            <option value="sports">Sports</option>
                            <option value="entertainment">Entertainment</option>
                            <option value="science">Science</option>
                            <option value="health">Health</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="domain-filter"><i class="fas fa-globe"></i> Domain</label>
                        <input type="text" id="domain-filter" placeholder="e.g., bbc.com, nytimes.com">
                    </div>
                </div>
                <div class="filter-actions">
                    <button id="apply-filters" class="btn btn-primary">
                        <i class="fas fa-check"></i> Apply Filters
                    </button>
                    <button id="clear-filters" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Clear All
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Loading Indicator -->
            <div class="loading" id="loading">
                <div class="loading-spinner">
                    <i class="fas fa-newspaper fa-spin"></i>
                </div>
                <p>Loading news from around the world...</p>
            </div>

            <!-- Error Display -->
            <div class="error-container" id="error-container" style="display: none;">
                <div class="error-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3>Unable to Load News</h3>
                <p id="error-message">There was an error loading the news. Please try again later.</p>
                <button id="retry-btn" class="btn btn-primary">
                    <i class="fas fa-redo"></i> Retry
                </button>
                <!-- NEW: Offline Fallback Button -->
                <button id="offline-fallback-btn" class="btn btn-secondary" style="display: none; margin-top: 10px;">
                    <i class="fas fa-download"></i> View Offline Articles
                </button>
            </div>

            <!-- Stats Bar -->
            <div class="stats-bar" id="stats-bar">
                <div class="stats-item">
                    <i class="fas fa-newspaper"></i>
                    <span id="article-count">0</span> Articles
                </div>
                <div class="stats-item">
                    <i class="fas fa-clock"></i> Updated: <span id="last-updated">Just now</span>
                </div>
                <div class="stats-item">
                    <i class="fas fa-language"></i> Language: <span id="current-language">English</span>
                </div>
                <!-- NEW: Offline Cache Stats -->
                <div class="stats-item" id="cache-stats" style="display: none;">
                    <i class="fas fa-database"></i> Cache: <span id="cache-size">0 MB</span>
                </div>
                <div class="stats-item" id="last-sync-item" style="display: none;">
                    <i class="fas fa-sync"></i> Last Sync: <span id="last-sync">Never</span>
                </div>
            </div>

            <!-- News Grid -->
            <div class="news-grid" id="news-grid">
                <!-- Articles will be inserted here by JavaScript -->
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination">
                <button id="prev-page" class="btn btn-secondary" disabled>
                    <i class="fas fa-chevron-left"></i> Previous
                </button>
                <div class="page-info">
                    Page <span id="current-page">1</span> of <span id="total-pages">1</span>
                </div>
                <button id="next-page" class="btn btn-secondary">
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <!-- NEW: Offline Management Section -->
            <div class="offline-management-section" id="offline-management-section" style="display: none;">
                <h2><i class="fas fa-download"></i> Offline Reading Management</h2>
                <p>Manage your saved articles for offline reading.</p>

                <div class="offline-controls">
                    <div class="offline-control-group">
                        <h4><i class="fas fa-database"></i> Storage</h4>
                        <p>Used: <span id="storage-used">0 MB</span> / <span id="storage-total">50 MB</span></p>
                        <div class="storage-bar">
                            <div class="storage-progress" id="storage-progress" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="offline-control-group">
                        <h4><i class="fas fa-cog"></i> Actions</h4>
                        <div class="offline-actions">
                            <button id="download-current-btn" class="btn btn-secondary">
                                <i class="fas fa-download"></i> Save Current Page
                            </button>
                            <button id="clear-cache-btn" class="btn btn-secondary">
                                <i class="fas fa-trash"></i> Clear Cache
                            </button>
                            <button id="view-offline-btn" class="btn btn-primary">
                                <i class="fas fa-newspaper"></i> View Offline Articles
                            </button>
                        </div>
                    </div>

                    <div class="offline-control-group">
                        <h4><i class="fas fa-info-circle"></i> Offline Tips</h4>
                        <ul class="offline-tips">
                            <li><i class="fas fa-check-circle"></i> Articles with the download icon are available offline</li>
                            <li><i class="fas fa-check-circle"></i> Bookmarked articles are automatically saved</li>
                            <li><i class="fas fa-check-circle"></i> Connect to WiFi to save multiple articles</li>
                            <li><i class="fas fa-check-circle"></i> Offline articles are searchable</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Historical Search Section -->
            <div class="historical-section">
                <h2><i class="fas fa-history"></i> Historical News Search</h2>
                <p>Search through historical news articles with advanced filtering options.</p>
                <div class="historical-form">
                    <input type="text" id="historical-search" placeholder="Enter keywords (e.g., Amazon, AI, Climate Change)">
                    <button id="historical-search-btn" class="btn btn-primary">
                        <i class="fas fa-search"></i> Search History
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3><i class="fas fa-newspaper"></i> Currents News</h3>
                    <p>Global news from over 50 countries in 15 languages. Powered by Currents News API.</p>
                    <div class="footer-links">
                        <a href="https://currentsapi.services/" target="_blank">API Documentation</a>
                        <a href="#" id="view-source">View Source Code</a>
                        <a href="#" id="refresh-news">Refresh News</a>
                        <!-- NEW: Offline Management Links -->
                        <a href="#" id="toggle-offline-management">Offline Settings</a>
                        <a href="#" id="clear-cache-footer">Clear Cache</a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3><i class="fas fa-info-circle"></i> About</h3>
                    <p>This application uses the Currents News API to provide real-time and historical news from thousands of sources worldwide.</p>
                    <div class="api-status">
                        <div class="status-indicator" id="api-status">
                            <span class="status-dot"></span> API Status: <span class="status-text">Connected</span>
                        </div>
                        <!-- NEW: Offline Status -->
                        <div class="status-indicator" id="offline-status" style="display: none; margin-top: 10px;">
                            <span class="status-dot offline"></span> Offline Mode: <span class="status-text offline">Active</span>
                        </div>
                    </div>
                    <!-- NEW: Cache Status -->
                    <div class="cache-info" id="cache-info" style="margin-top: 15px; display: none;">
                        <p><i class="fas fa-database"></i> Offline Cache: <span id="footer-cache-size">0 articles</span></p>
                        <p style="font-size: 12px; opacity: 0.7;">Last updated: <span id="footer-last-update">Never</span></p>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Currents News App. Data provided by <a href="https://currentsapi.services/" target="_blank">Currents News API</a>.</p>
                <p class="disclaimer">Â© 2026 Timothy Thumbi. All rights reserved. This application, including its content, layout, and source code, is the exclusive property of Timothy Thumbi and is protected by applicable copyright and intellectual property laws.</p>
            </div>
        </div>
    </footer>

    <!-- Article Modal -->
    <div class="modal" id="article-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Article Title</h2>
                <button class="modal-close" id="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="modal-meta">
                    <span id="modal-source">Source</span>
                    <span id="modal-date">Date</span>
                    <span id="modal-author">Author</span>
                    <span id="modal-category">Category</span>
                    <!-- NEW: Offline Availability Badge -->
                    <span id="modal-offline-badge" style="display: none;">
                        <i class="fas fa-download"></i> Available Offline
                    </span>
                </div>
                <div class="modal-image-container">
                    <img id="modal-image" src="" alt="Article Image">
                </div>
                <div class="modal-description">
                    <p id="modal-description">Article description...</p>
                </div>
                <div class="modal-actions">
                    <a href="#" target="_blank" id="modal-read-full" class="btn btn-primary">
                        <i class="fas fa-external-link-alt"></i> Read Full Article
                    </a>
                    <button id="modal-share" class="btn btn-secondary">
                        <i class="fas fa-share-alt"></i> Share
                    </button>
                    <button id="modal-bookmark" class="btn btn-secondary">
                        <i class="far fa-bookmark"></i> Bookmark
                    </button>
                    <!-- NEW: Save for Offline Button -->
                    <button id="save-for-offline" class="btn btn-secondary">
                        <i class="fas fa-download"></i> Save Offline
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add this modal at the end of body -->
    <div class="modal" id="api-key-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-key"></i> API Key Required</h2>
            </div>
            <div class="modal-body">
                <div class="api-key-form">
                    <p>This app requires a Currents News API key to fetch real news.</p>

                    <div class="steps">
                        <h3>How to get your free API key:</h3>
                        <ol>
                            <li>Visit <a href="https://currentsapi.services/" target="_blank">currentsapi.services</a></li>
                            <li>Sign up for a free account</li>
                            <li>Get your API key from the dashboard</li>
                            <li>Paste it below</li>
                        </ol>
                    </div>

                    <div class="form-group">
                        <label for="api-key-input">
                        <i class="fas fa-key"></i> Your Currents API Key
                    </label>
                        <input type="password" id="api-key-input" placeholder="Paste your API key here" autocomplete="off">
                    </div>

                    <div class="form-group">
                        <label>
                        <input type="checkbox" id="save-api-key" checked>
                        Remember my key in this browser
                    </label>
                    </div>

                    <div class="modal-actions">
                        <button id="save-key-btn" class="btn btn-primary">
                        <i class="fas fa-check"></i> Save & Continue
                    </button>
                        <button id="try-demo-btn" class="btn btn-secondary">
                        <i class="fas fa-eye"></i> Try Demo Mode First
                    </button>
                    </div>

                    <div class="privacy-note">
                        <p><small><i class="fas fa-lock"></i> Your API key is stored locally in your browser and never sent to our servers.</small></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Offline Cache Management Modal -->
    <div class="modal" id="cache-management-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-database"></i> Offline Cache Management</h2>
                <button class="modal-close" id="cache-modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="cache-stats">
                    <div class="stat-item">
                        <i class="fas fa-newspaper"></i>
                        <div>
                            <h4>Articles Stored</h4>
                            <p id="cache-article-count">0</p>
                        </div>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-database"></i>
                        <div>
                            <h4>Storage Used</h4>
                            <p id="cache-storage-used">0 MB</p>
                        </div>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-clock"></i>
                        <div>
                            <h4>Last Updated</h4>
                            <p id="cache-last-updated">Never</p>
                        </div>
                    </div>
                </div>

                <div class="cache-actions">
                    <h3><i class="fas fa-cog"></i> Actions</h3>
                    <div class="action-buttons">
                        <button id="refresh-cache-btn" class="btn btn-secondary">
                            <i class="fas fa-sync"></i> Refresh Cache
                        </button>
                        <button id="download-all-btn" class="btn btn-secondary">
                            <i class="fas fa-download"></i> Save All Current
                        </button>
                        <button id="clear-cache-confirm-btn" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Clear All Cache
                        </button>
                    </div>
                </div>

                <div class="cache-info">
                    <h3><i class="fas fa-info-circle"></i> Information</h3>
                    <ul>
                        <li>Articles are automatically cached when you read them</li>
                        <li>Bookmarked articles are permanently saved</li>
                        <li>Cache is cleared when storage is full (oldest first)</li>
                        <li>Offline articles remain available for 30 days</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Install App Button -->
    <button id="install-btn" class="install-btn" style="display: none;">
    <i class="fas fa-download"></i>
    <span>Install App</span>
</button>

    <!-- NEW: Offline Mode Indicator (Fixed) -->
    <div class="offline-indicator" id="offline-indicator" style="display: none;">
        <i class="fas fa-wifi-slash"></i>
        <span>Working Offline</span>
        <button id="offline-indicator-close" class="btn-close">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- NEW: Quick Action Buttons (Floating) -->
    <div class="quick-actions" id="quick-actions">
        <button class="quick-action" id="quick-offline" title="Save for Offline">
            <i class="fas fa-download"></i>
        </button>
        <button class="quick-action" id="quick-cache" title="Cache Management">
            <i class="fas fa-database"></i>
        </button>
    </div>

    <script src="offline-integration.js"></script>
    <script src="script.js"></script>

</body>

</html>